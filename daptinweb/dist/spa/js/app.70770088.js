(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{0:function(e,t,n){e.exports=n("2f39")},"034f":function(e,t,n){"use strict";var a=n("ed82"),o=n.n(a);o.a},"2f39":function(t,n,a){"use strict";a.r(n);var o={};a.r(o),a.d(o,"loggedIn",(function(){return $})),a.d(o,"endpoint",(function(){return U})),a.d(o,"authToken",(function(){return Q})),a.d(o,"decodedAuthToken",(function(){return A})),a.d(o,"tables",(function(){return E}));var l={};a.r(l),a.d(l,"setToken",(function(){return M})),a.d(l,"setDefaultCloudStore",(function(){return z})),a.d(l,"setSelectedTable",(function(){return B})),a.d(l,"clearTablesCache",(function(){return L})),a.d(l,"setTables",(function(){return H}));var i={};a.r(i),a.d(i,"loadTables",(function(){return K})),a.d(i,"setToken",(function(){return Y})),a.d(i,"setSelectedTable",(function(){return X})),a.d(i,"getDefaultCloudStore",(function(){return Z})),a.d(i,"executeAction",(function(){return ee})),a.d(i,"deleteRow",(function(){return te})),a.d(i,"createRow",(function(){return ne})),a.d(i,"updateRow",(function(){return ae})),a.d(i,"removeRelation",(function(){return oe})),a.d(i,"addRelation",(function(){return le})),a.d(i,"addManyRelation",(function(){return ie})),a.d(i,"loadData",(function(){return re})),a.d(i,"loadOneData",(function(){return se})),a.d(i,"loadDataRelations",(function(){return ce})),a.d(i,"loadAggregates",(function(){return ue})),a.d(i,"loadServerConfig",(function(){return de})),a.d(i,"saveConfig",(function(){return pe})),a.d(i,"getTableSchema",(function(){return me})),a.d(i,"loadModel",(function(){return fe})),a.d(i,"refreshTableSchema",(function(){return be}));var r=a("967e"),s=a.n(r),c=(a("a481"),a("96cf"),a("fa84")),u=a.n(c),d=(a("573e"),a("e54f"),a("985d"),a("31cd"),a("a1e8"),a("2b0e")),p=a("1f91"),m=a("42d2"),f=a("b05d"),b=a("05c0"),h=a("2a19"),g=a("1b3f"),v=a("d66b"),w=a("52ee"),y=a("7d53"),C=a("436b"),T=a("f508");d["a"].use(f["a"],{config:{notify:{position:"bottom-right"}},lang:p["a"],iconSet:m["a"],plugins:{QTooltip:b["a"],Notify:h["a"],LoadingBar:g["a"],QEditor:v["a"],QDate:w["a"],QFile:y["a"],Dialog:C["a"],Loading:T["a"]}});var _=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"q-app"}},[n("router-view")],1)},x=[],q=(a("8e6e"),a("8a81"),a("ac6a"),a("cadf"),a("06db"),a("456d"),a("c47a")),O=a.n(q),S=a("2f62");function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var j={data:function(){return N({showLogin:!1},Object(S["c"])(["loggedIn"]))},methods:N({},Object(S["b"])([])),name:"App",mounted:function(){console.log("Loaded app user is ",this.loggedIn()),this.loggedIn()||this.$router.push("/login")}},P=j,R=(a("034f"),a("2877")),F=Object(R["a"])(P,_,x,!1,null,null,null),G=F.exports,D=a("04e1"),I=function(){return{tables:{},token:localStorage.getItem("token"),decodedAuthToken:null==localStorage.getItem("token")?null:D(localStorage.getItem("token")),defaultCloudStore:null,showHiddenTables:!0,endpoint:"site.daptin.com"===window.location.hostname?"http://localhost:6336":window.location.protocol+"//"+window.location.hostname+("80"===window.location.port?"":":"+window.location.port)}};function $(e){var t=e.token;return!!t}function U(e){return e.endpoint}function Q(e){return e.token}function A(e){return e.decodedAuthToken}function E(e){return console.log("Get tables, ",e.tables),Object.keys(e.tables).filter((function(e){return-1===e.indexOf("_has_")})).map((function(t){return e.tables[t]})).filter((function(t){return!!e.showHiddenTables||0!==t.is_hidden&&void 0}))}function M(e,t){e.token=t}function z(e,t){e.defaultCloudStore=t}function B(e,t){console.log("set selected table",t),e.selectedTable=t}function L(e){}function H(e,t){for(var n in e.tables={},t)d["a"].set(e.tables,n,t[n]);console.log("Tables set to ",e.tables)}a("551c"),a("7f7f"),a("7514");var V=a("6854"),W="site.daptin.com"===window.location.hostname?"http://localhost:6336":window.location.protocol+"//"+window.location.hostname+("80"===window.location.port?"":":"+window.location.port);console.log("Daptin endpoint is:",W);var J=new V["DaptinClient"](W,!1,{getToken:function(){return localStorage.getItem("token")}});function K(e){var t=e.commit;console.log("Load tables"),J.worldManager.loadModels(!0).then((function(e){console.log("All models loaded",arguments),t("setTables",e)})).catch((function(e){console.log("Failed to connect to backend",e)}))}function Y(e){var t=e.commit,n=localStorage.getItem("token");if(!n)throw"Failed to login";t("setToken",n)}function X(e,t){var n=e.commit;n("setSelectedTable",t)}function Z(e){var t=e.commit;console.log("Find default cloud store"),J.jsonApi.findAll("cloud_store",{query:JSON.stringify([{column:"name",operator:"is",value:"localstore"}])}).then((function(e){console.log("Found cloud store",e);var n=e.data[0];t("setDefaultCloudStore",n)})).catch((function(e){console.log("Failed to find default cloud store",e)}))}function ee(e,t){e.commit;var n=t.tableName,a=t.actionName;return J.actionManager.doAction(n,a,t.params)}function te(e,t){e.commit;return J.jsonApi.destroy(t.tableName,t.reference_id)}function ne(e,t){e.commit;var n=t.tableName;return delete t.tableName,J.jsonApi.create(n,t)}function ae(e,t){e.commit;var n=t.tableName;return delete t.tableName,J.jsonApi.update(n,t)}function oe(e,t){e.commit;return J.jsonApi.one(t.tableName,t.id).relationships(t.relationName).destroy([{type:t.relationName,id:t.relationId}])}function le(e,t){e.commit;return J.jsonApi.one(t.tableName,t.id).relationships(t.relationName).patch({type:t.relationName,id:t.relationId})}function ie(e,t){e.commit;return J.jsonApi.one(t.tableName,t.id).relationships(t.relationName).patch([{type:t.relationName,id:t.relationId}])}function re(e,t){e.commit;var n=t.tableName;return t=t.params,J.jsonApi.findAll(n,t)}function se(e,t){e.commit;var n=t.tableName;return J.jsonApi.find(n,t.referenceId)}function ce(e,t){e.commit;var n=t.tableName,a=t.relation,o=t.reference_id;return J.jsonApi.one(n,o).all(a).get()}function ue(e,t){e.commit;var n=t.tableName;return J.statsManager.getStats(n,t)}function de(e){e.commit;return J.configManager.getAllConfig()}function pe(e,t){e.commit;return J.configManager.setConfig(t.name,"backend",t.value)}function me(e,t){e.commit;return new Promise((function(e,n){J.worldManager.loadModel(t,!0).then((function(){e(J.worldManager.getColumnKeys(t,!0))})).catch(n)}))}function fe(e,t){e.commit;return J.worldManager.loadModel(t,!0)}function be(e,t){var n=e.commit;return J.worldManager.loadModels(!0).then((function(e){console.log("All models loaded",arguments),n("setTables",e)})).catch((function(e){console.log("Failed to connect to backend",e)})),J.worldManager.refreshWorld(t,!0)}J.worldManager.init();var he={getters:o,mutations:l,actions:i,state:I};d["a"].use(S["a"]);var ge=function(){var e=new S["a"].Store({modules:{daptin:he},strict:!1});return e},ve=a("8c4f"),we=[{path:"/login",component:function(){return Promise.all([a.e(0),a.e(2)]).then(a.bind(null,"eeb7"))},children:[{path:"",component:function(){return a.e(18).then(a.bind(null,"013f"))}}]},{path:"/register",component:function(){return Promise.all([a.e(0),a.e(2)]).then(a.bind(null,"eeb7"))},children:[{path:"",component:function(){return a.e(19).then(a.bind(null,"e422"))}}]},{path:"/tables",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"",component:function(){return a.e(21).then(a.bind(null,"8c1a"))}},{path:"create",component:function(){return a.e(12).then(a.bind(null,"2fba"))}},{path:"apidocs",component:function(){return Promise.all([a.e(0),a.e(10)]).then(a.bind(null,"0f5a"))}},{path:"graphql",component:function(){return Promise.all([a.e(0),a.e(11)]).then(a.bind(null,"3507"))}},{path:"edit/:tableName",component:function(){return a.e(15).then(a.bind(null,"2711"))}},{path:"data/:tableName",component:function(){return Promise.all([a.e(0),a.e(6)]).then(a.bind(null,"4fc5"))}}]},{path:"/users",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"",component:function(){return a.e(24).then(a.bind(null,"051b"))}}]},{path:"/user",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"profile",component:function(){return Promise.all([a.e(0),a.e(23)]).then(a.bind(null,"4336"))}},{path:":emailId",component:function(){return a.e(16).then(a.bind(null,"1c97"))}}]},{path:"/groups",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"",component:function(){return a.e(22).then(a.bind(null,"cbb4"))}},{path:":groupId",component:function(){return a.e(14).then(a.bind(null,"b8c4"))}}]},{path:"/integrations",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"spec",component:function(){return a.e(9).then(a.bind(null,"a8e1"))}},{path:"actions",component:function(){return a.e(8).then(a.bind(null,"c518"))}}]},{path:"/cloudstore",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"",component:function(){return a.e(3).then(a.bind(null,"aa0a"))}},{path:"sites",component:function(){return Promise.all([a.e(0),a.e(20)]).then(a.bind(null,"c582"))}},{path:"/edit/:cloudStoreId",component:function(){return a.e(3).then(a.bind(null,"aa0a"))}}]},{path:"/",component:function(){return Promise.all([a.e(0),a.e(1)]).then(a.bind(null,"713b"))},children:[{path:"",component:function(){return Promise.all([a.e(0),a.e(17)]).then(a.bind(null,"8b24"))}},{path:"data",component:function(){return a.e(13).then(a.bind(null,"c635"))}}]}];we.push({path:"*",component:function(){return a.e(7).then(a.bind(null,"e51e"))}});var ye=we;d["a"].use(ve["a"]);var Ce=function(){var e=new ve["a"]({scrollBehavior:function(){return{x:0,y:0}},routes:ye,mode:"hash",base:""});return e},Te=function(){return _e.apply(this,arguments)};function _e(){return _e=u()(s.a.mark((function e(){var t,n,a;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("function"!==typeof ge){e.next=6;break}return e.next=3,ge({Vue:d["a"]});case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=ge;case 7:if(t=e.t0,"function"!==typeof Ce){e.next=14;break}return e.next=11,Ce({Vue:d["a"],store:t});case 11:e.t1=e.sent,e.next=15;break;case 14:e.t1=Ce;case 15:return n=e.t1,t.$router=n,a={router:n,store:t,render:function(e){return e(G)}},a.el="#q-app",e.abrupt("return",{app:a,store:t,router:n});case 20:case"end":return e.stop()}}),e)}))),_e.apply(this,arguments)}var xe=a("a925"),qe={failed:"Action failed",success:"Action was successful"},Oe={"en-us":qe};d["a"].use(xe["a"]);var Se=new xe["a"]({locale:"en-us",fallbackLocale:"en-us",messages:Oe}),ke=function(e){var t=e.app;t.i18n=Se},Ne=a("bc3a"),je=a.n(Ne),Pe=a("a633"),Re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-form",{staticClass:"q-gutter-md"},[n("div",{staticClass:"row",staticStyle:{"padding-bottom":"10px"}},[n("div",{staticClass:"col-md-6"},[n("span",{staticClass:"text-h4"},[e._v(e._s(e.isEdit?"Edit table":"Create table"))])])]),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4"},[n("q-input",{attrs:{filled:"",size:"sm",placeholder:"Table name",readonly:e.isEdit,"lazy-rules":"",rules:[function(e){return e&&e.length>0||"Table name cannot be empty"}]},model:{value:e.localTable.TableName,callback:function(t){e.$set(e.localTable,"TableName",t)},expression:"localTable.TableName"}})],1),n("div",{staticClass:"col-md-4 offset-4"},[n("div",[n("q-btn",{attrs:{disable:!(e.localTable.ColumnModel&&e.localTable.ColumnModel.length>0),size:"20px",label:e.isEdit?"Save":"Create",type:"submit",color:"green"},on:{click:e.createTable}})],1)]),n("div",{staticClass:"col-12"},[n("hr")])]),n("q-tabs",{staticClass:"text-grey",attrs:{dense:"","active-color":"primary","indicator-color":"primary",align:"justify","narrow-indicator":""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab",{attrs:{name:"columns",label:"Columns"}}),n("q-tab",{attrs:{name:"relations",label:"Relations"}})],1),n("q-separator"),n("div",{staticClass:"row"},[n("div",{staticClass:"col-md-12"},[n("q-tab-panels",{attrs:{animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("q-tab-panel",{attrs:{name:"columns"}},[n("span",{staticClass:"text-h6"},[e._v("Columns")]),n("small",[e._v(" ("+e._s((e.table.TableName?e.localTable.ColumnModel.length-e.StandardColumns.length:Object.keys(e.localTable.ColumnModel).length)+" plus "+e.StandardColumns.length+" base columns")+")\n          ")]),e._l(e.localTable.ColumnModel.filter((function(t){return t.ColumnName&&-1===e.StandardColumns.indexOf(t.ColumnName)&&(!t.IsForeignKey||t.IsForeignKey&&"cloud_store"===t.ForeignKeyData.DataSource)})),(function(t){return n("div",{staticClass:"row"},[n("div",{staticClass:"col-3",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"column Name",readonly:!t.notCreated},model:{value:t.ColumnName,callback:function(n){e.$set(t,"ColumnName",n)},expression:"column.ColumnName"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{placeholder:"column type",readonly:!t.notCreated,options:e.ColumnTypes.map((function(e){return e.columnType+" - "+e.dataType})),label:"Column Type"},model:{value:t.ColumnType,callback:function(n){e.$set(t,"ColumnType",n)},expression:"column.ColumnType"}})],1),n("div",{staticClass:"col-3",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"default value (string values inside single quote)"},model:{value:t.DefaultValue,callback:function(n){e.$set(t,"DefaultValue",n)},expression:"column.DefaultValue"}})],1),n("div",{staticClass:"col-4",staticStyle:{padding:"5px"}},[n("q-checkbox",{attrs:{disable:!t.notCreated&&t.IsNullable,size:"xs",label:"Nullable"},model:{value:t.IsNullable,callback:function(n){e.$set(t,"IsNullable",n)},expression:"column.IsNullable"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this if this column can be left empty ("),n("b",[e._v("no value")]),e._v(" is different from zero value)\n                ")])],1),n("q-checkbox",{attrs:{disable:!t.notCreated&&t.IsUnique,size:"xs",label:"Unique"},model:{value:t.IsUnique,callback:function(n){e.$set(t,"IsUnique",n)},expression:"column.IsUnique"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this to ensure that this column has no duplicate values\n                ")])],1),n("q-checkbox",{attrs:{disable:!t.notCreated&&t.IsIndexed,size:"xs",label:"Indexed"},model:{value:t.IsIndexed,callback:function(n){e.$set(t,"IsIndexed",n)},expression:"column.IsIndexed"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this if you are going to search on this column using the API\n                ")])],1),n("q-btn",{attrs:{icon:"fas fa-trash",flat:"",size:"sm"},on:{click:function(n){return e.$emit("deleteColumn",t)}}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Delete this column metadata from drop column from database\n                ")])],1)],1)])})),n("div",{staticClass:"row"},[n("div",{staticClass:"col-3",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"column name"},on:{blur:function(t){return e.columnNameUpdated()}},model:{value:e.newColumn.ColumnName,callback:function(t){e.$set(e.newColumn,"ColumnName",t)},expression:"newColumn.ColumnName"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{placeholder:"column Type",options:e.ColumnTypes.map((function(e){return e.columnType+" - "+e.dataType})),label:"column type"},on:{input:function(t){return e.columnNameUpdated()}},model:{value:e.newColumn.ColumnType,callback:function(t){e.$set(e.newColumn,"ColumnType",t)},expression:"newColumn.ColumnType"}})],1),n("div",{staticClass:"col-3",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"default value (string values inside single quote)"},model:{value:e.newColumn.DefaultValue,callback:function(t){e.$set(e.newColumn,"DefaultValue",t)},expression:"newColumn.DefaultValue"}})],1),n("div",{staticClass:"col-4",staticStyle:{padding:"5px"}},[n("q-checkbox",{attrs:{size:"xs",label:"Nullable"},model:{value:e.newColumn.IsNullable,callback:function(t){e.$set(e.newColumn,"IsNullable",t)},expression:"newColumn.IsNullable"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this if this column can be left empty ("),n("b",[e._v("no value")]),e._v(" is different from zero value)\n                ")])],1),n("q-checkbox",{attrs:{size:"xs",label:"Unique"},model:{value:e.newColumn.IsUnique,callback:function(t){e.$set(e.newColumn,"IsUnique",t)},expression:"newColumn.IsUnique"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this to ensure that this column has no duplicate values\n                ")])],1),n("q-checkbox",{attrs:{size:"xs",label:"Indexed"},model:{value:e.newColumn.IsIndexed,callback:function(t){e.$set(e.newColumn,"IsIndexed",t)},expression:"newColumn.IsIndexed"}},[n("q-tooltip",{attrs:{"content-style":"font-size: 16px"}},[e._v("\n                  Check this if you are going to search on this column using the API\n                ")])],1)],1)])],2),n("q-tab-panel",{attrs:{name:"relations"}},[n("span",{staticClass:"text-h6"},[e._v("Relations "+e._s(e.isEdit))]),n("small",[e._v("("+e._s(e.isEdit?e.localTable.Relations.length-e.StandardRelations.length:e.localTable.Relations.length)+" +\n            2\n            default)\n          ")]),e._l(e.localTable.Relations||[],(function(t){return-1==e.StandardRelations.indexOf(t.SubjectName)&&-1==e.StandardRelations.indexOf(t.ObjectName)?n("div",{staticClass:"row"},[n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-input",{model:{value:t.SubjectName,callback:function(n){e.$set(t,"SubjectName",n)},expression:"relation.SubjectName"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{options:e.tables.map((function(e){return e.table_name}))},on:{input:function(n){return e.checkRelation(t,"subject")}},model:{value:t.Subject,callback:function(n){e.$set(t,"Subject",n)},expression:"relation.Subject"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{options:e.RelationTypes},model:{value:t.Relation,callback:function(n){e.$set(t,"Relation",n)},expression:"relation.Relation"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{options:e.tables.map((function(e){return e.table_name}))},on:{input:function(n){return e.checkRelation(t,"object")}},model:{value:t.Object,callback:function(n){e.$set(t,"Object",n)},expression:"relation.Object"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-input",{model:{value:t.ObjectName,callback:function(n){e.$set(t,"ObjectName",n)},expression:"relation.ObjectName"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-btn",{attrs:{icon:"fas fa-times",flat:"",size:"sm"},on:{click:function(n){return e.$emit("deleteRelation",t)}}})],1)]):e._e()})),n("div",{staticClass:"row"},[n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"optional subject name"},model:{value:e.newRelation.SubjectName,callback:function(t){e.$set(e.newRelation,"SubjectName",t)},expression:"newRelation.SubjectName"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{placeholder:"column Name",options:e.tables.map((function(e){return e.table_name}))},on:{input:function(t){return e.updatedRelation("subject")}},model:{value:e.newRelation.Subject,callback:function(t){e.$set(e.newRelation,"Subject",t)},expression:"newRelation.Subject"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{hint:"relation type",placeholder:"relation type",options:e.RelationTypes},on:{input:function(t){return e.updatedRelation("relation")}},model:{value:e.newRelation.Relation,callback:function(t){e.$set(e.newRelation,"Relation",t)},expression:"newRelation.Relation"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-select",{attrs:{hint:"related object",placeholder:"related object",options:e.tables.map((function(e){return e.table_name}))},on:{input:function(t){return e.updatedRelation("object")}},model:{value:e.newRelation.Object,callback:function(t){e.$set(e.newRelation,"Object",t)},expression:"newRelation.Object"}})],1),n("div",{staticClass:"col-2",staticStyle:{padding:"5px"}},[n("q-input",{attrs:{placeholder:"optional object name"},model:{value:e.newRelation.ObjectName,callback:function(t){e.$set(e.newRelation,"ObjectName",t)},expression:"newRelation.ObjectName"}})],1)])],2)],1)],1)]),e.isEdit?n("div",{staticClass:"row q-pa-md",staticStyle:{"padding-bottom":"10px"}},[n("div",{staticClass:"col-md-12"},[n("q-btn",{attrs:{color:"red",label:"Delete table"},on:{click:function(t){return e.deleteTable()}}})],1)]):e._e()],1)},Fe=[];function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie={props:{table:Object,tableData:Object},mounted:function(){var e=this;console.log("Mounted table editor ",this.table);var t=this;this.table.ColumnModel&&(this.table.Relations=[],this.localTable={TableName:this.$route.params.tableName,ColumnModel:[],Relations:[]},this.localTable.ColumnModel=Object.keys(this.table.ColumnModel).map((function(e){return t.table.ColumnModel[e]})).filter((function(e){return!e.jsonApi&&"__type"!==e.ColumnName&&-1===t.StandardColumns.indexOf(e.ColumnName)})),this.localTable.Relations=Object.keys(this.table.ColumnModel).filter((function(t){return e.table.ColumnModel[t].jsonApi})).map((function(e){console.log("Relation ",e);var n=t.table.ColumnModel[e],a="has_one";switch(n.jsonApi){case"hasOne":a="has_one";break;case"belongsTo":a="belongs_to";break;case"hasMany":a="has_many";break}return{Subject:t.tableName,Relation:a,Object:n.type}})),this.isEdit=!0),this.newRelation.Subject=this.table.TableName},methods:{deleteTable:function(){var e=this,t=this;console.log("Delete table",this.localTable),this.$q.dialog({title:"Confirm",message:'Do you want to delete the table "'+this.localTable.TableName+'"',cancel:!0,persistent:!0}).onOk((function(){t.$emit("deleteTable",e.localTable.TableName)})).onCancel((function(){})).onDismiss((function(){}))},createTable:function(){var e=this;this.localTable.TableName?this.tables.filter((function(t){return t.table_name===e.localTable.TableName})).length>0?this.$q.notify("Table name already used"):this.$emit("save",this.localTable):this.$q.notify("Table name cannot be empty")},checkRelation:function(e,t){e.Subject!==this.table.TableName&&e.Object!==this.table.TableName&&("subject"===t?e.Object=this.table.TableName:"object"===t&&(e.Subject=this.table.TableName))},updatedRelation:function(e){if(this.newRelation.Subject!==this.localTable.TableName&&this.newRelation.Object!==this.localTable.TableName){if("subject"===e)return void(this.newRelation.Object=this.localTable.TableName);if("object"===e)return void(this.newRelation.Subject=this.localTable.TableName)}this.newRelation.Object&&this.newRelation.Relation&&(this.localTable.Relations.push(this.newRelation),this.newRelation={Subject:this.localTable.TableName,Relation:null,Object:null})},columnNameUpdated:function(){console.log("new column updated",arguments),this.newColumn.ColumnName&&this.newColumn.ColumnType&&(this.localTable.ColumnModel.push(this.newColumn),this.newColumn={ColumnName:null,ColumnType:null,DefaultValue:null,IsIndexed:!1,IsUnique:!1,IsNullable:!0,notCreated:!0})}},name:"TableEditor",data:function(){return{tab:"columns",StandardColumns:["id","created_at","updated_at","reference_id","permission","version"],StandardRelations:["user_account_id","usergroup_id"],ColumnTypes:[{columnType:"label",dataType:"varchar(50)"},{columnType:"label",dataType:"varchar(100)"},{columnType:"content",dataType:"varchar(500)"},{columnType:"content",dataType:"varchar(1000)"},{columnType:"content",dataType:"text"},{columnType:"measurement",dataType:"int(4)"},{columnType:"measurement",dataType:"int(11)"},{columnType:"measurement",dataType:"float(11)"},{columnType:"file.mp3|wav",dataType:"blob"},{columnType:"file.mp4|mkv",dataType:"blob"},{columnType:"file.jpg|png|gif",dataType:"blob"},{columnType:"json",dataType:"json"},{columnType:"datetime",dataType:"timestamp"},{columnType:"value",dataType:"int(11)"},{columnType:"alias",dataType:"varchar(30)"},{columnType:"truefalse",dataType:"int(1)"},{columnType:"gzip",dataType:"blob"}],RelationTypes:["has_one","belongs_to","has_many"],tableName:null,isEdit:!1,localTable:{TableName:null,ColumnModel:[],Relations:[]},newColumn:{ColumnName:null,ColumnType:null,DefaultValue:null,notCreated:!0,IsIndexed:!1,IsUnique:!1,IsNullable:!0},newRelation:{Subject:null,Relation:null,Object:null}}},computed:De({},Object(S["c"])(["tables"])),watch:{"localTable.TableName":function(e,t){if(console.log("Name changed",e,t,this.localTable.Relations),this.tableName=e,this.localTable&&this.localTable.Relations){this.localTable.TableName=e;for(var n=0;n<this.localTable.Relations.length;n++)this.localTable.Relations[n].Subject===t?this.localTable.Relations[n].Subject=e:this.localTable.Relations[n].Object===t&&(this.localTable.Relations[n].Object=e);this.newRelation.Subject=e}}}},$e=Ie,Ue=a("0378"),Qe=a("27f9"),Ae=a("9c40"),Ee=a("429bb"),Me=a("7460"),ze=a("eb85"),Be=a("adad"),Le=a("823b"),He=a("ddd8"),Ve=a("8f8e"),We=a("eebe"),Je=a.n(We),Ke=Object(R["a"])($e,Re,Fe,!1,null,"7911e017",null),Ye=Ke.exports;Je()(Ke,"components",{QForm:Ue["a"],QInput:Qe["a"],QBtn:Ae["a"],QTabs:Ee["a"],QTab:Me["a"],QSeparator:ze["a"],QTabPanels:Be["a"],QTabPanel:Le["a"],QSelect:He["a"],QCheckbox:Ve["a"],QTooltip:b["a"]});var Xe=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 q-pa-md items-start q-gutter-md"},[n("q-page-sticky",{attrs:{position:"top-right",offset:[20,20]}},[n("q-btn",{attrs:{flat:"",icon:"fas fa-times"},on:{click:function(t){return e.$emit("close")}}})],1),n("q-card",{staticClass:"bg-grey-3",attrs:{flat:""}},[n("q-card-section",[n("q-select",{attrs:{"option-value":"value","map-options":"","emit-value":"","option-label":"label",options:e.simplePermissionOptions},on:{input:function(t){return e.saveTablePermissionModel()}},model:{value:e.selectedPermissionOption,callback:function(t){e.selectedPermissionOption=t},expression:"selectedPermissionOption"}})],1)],1)],1),n("div",{staticClass:"col-12 q-pa-md items-start q-gutter-md"},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Table owner")])]),n("q-card-section",{staticClass:"q-pt-none"},[e._v("\n          "+e._s(e.selectedTable.user_account_id?e.selectedTable.user_account_id.email:"n/a")+"\n        ")]),n("q-card-actions",[n("q-btn",{attrs:{flat:""},on:{click:function(t){return e.showOwnerSelectionBox()}}},[e._v("Change owner")])],1)],1),n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Table groups")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-markup-table",{attrs:{flat:""}},[n("tbody",e._l(e.tableGroups,(function(t){return n("tr",[n("td",[e._v(e._s(t.name))]),n("td",{staticClass:"text-right"},[n("q-btn",{attrs:{icon:"fas fa-trash",flat:"",size:"xs"},on:{click:function(n){return e.removeTableFromGroup(t)}}})],1)])})),0)])],1),n("q-card-actions",[n("div",{staticClass:"row"},[n("q-btn",{staticClass:"float-right",attrs:{flat:"",label:"Add group"},on:{click:function(t){return e.groupChangeForTableGroups()}}})],1)])],1),n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("New row to be added to following groups")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-markup-table",{attrs:{flat:""}},[n("tbody",e._l(e.tableSchema.DefaultGroups,(function(t){return n("tr",[n("td",[e._v(e._s(t))]),n("td",{staticClass:"text-right"},[n("q-btn",{attrs:{icon:"fas fa-trash",flat:"",size:"xs"},on:{click:function(n){return e.removeGroupFromDefaultGroups(t)}}})],1)])})),0)])],1),n("q-card-actions",[n("q-btn",{attrs:{flat:"",label:"Add group"},on:{click:function(t){return e.groupChangeForNewRowGroups()}}})],1)],1)],1)]),n("q-dialog",{model:{value:e.addToGroup,callback:function(t){e.addToGroup=t},expression:"addToGroup"}},[n("q-card",[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Add table to new group")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-select",{attrs:{flat:"",options:e.userGroups,"option-label":"name","option-value":"reference_id"},model:{value:e.addToGroupId,callback:function(t){e.addToGroupId=t},expression:"addToGroupId"}})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"warning"}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Add",color:"primary"},on:{click:function(t){return e.updateTableGroups()}}})],1)],1)],1),n("q-dialog",{model:{value:e.ownerSelectionBox,callback:function(t){e.ownerSelectionBox=t},expression:"ownerSelectionBox"}},[n("q-card",{staticStyle:{width:"600px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Set new owner")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-select",{attrs:{flat:"",options:e.userAccounts,"option-label":"email","option-value":"reference_id"},model:{value:e.newOwnerId,callback:function(t){e.newOwnerId=t},expression:"newOwnerId"}})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel",color:"warning"}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Set",color:"primary"},on:{click:function(t){return e.setOwner(e.newOwnerId)}}})],1)],1)],1)],1)},Ze=[];function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt={name:"TablePermissions",props:{selectedTable:Object},methods:tt(tt({removeGroupFromDefaultGroups:function(e){var t=this,n=t.tableSchema.DefaultGroups;console.log("Current groups",e);var a=n.indexOf(e);-1!==a&&(n.splice(a,1),t.updateRow({tableName:"world",id:t.selectedTable.reference_id,world_schema_json:JSON.stringify(t.tableSchema)}).then((function(){t.$q.notify({message:"Saved"})})).catch((function(e){console.log("Failed to remove group from default groups",e),t.$q.notify({message:"Failed to save"})})))},saveTablePermissionModel:function(){console.log("new table permission",this.selectedPermissionOption);var e=this;e.updateRow({tableName:"world",id:e.selectedTable.reference_id,permission:e.selectedPermissionOption,default_permission:e.selectedPermissionOption}).then((function(t){console.log("Updated table permisson",t),e.loadTableGroups()})).catch((function(t){e.$q.notify({message:"Failed to update table permission"})}))},removeTableFromGroup:function(e){console.log("removeTableFromGroup",e);var t=this;t.removeRelation({tableName:"usergroup",id:e.relation_reference_id,relationName:"world_id",relationId:t.selectedTable.reference_id}).then((function(e){console.log("Removed user ",e),t.loadTableGroups()})).catch((function(e){t.$q.notify({message:"Failed to remove table from group"})}))},updateTableGroups:function(){var e=this;switch(console.log("Add groups",this.groupChangeFor,this.addToGroupId),this.groupChangeFor){case"tableGroups":e.addManyRelation({tableName:"world",id:e.selectedTable.reference_id,relationId:this.addToGroupId.id,relationName:"usergroup_id"}).then((function(){e.$q.notify({message:"Added group"}),e.loadTableGroups()})).catch((function(t){console.log("Failed to add group",t),e.$q.notify({message:"Failed to save"})}));break;case"newRowGroups":var t=e.tableSchema.DefaultGroups;console.log("Current groups",t),t.push(this.addToGroupId.name),e.updateRow({tableName:"world",id:e.selectedTable.reference_id,world_schema_json:JSON.stringify(e.tableSchema)}).then((function(){e.$q.notify({message:"Saved"})})).catch((function(t){console.log("Failed to add new group",t),e.$q.notify({message:"Failed to save"})}));break}},setOwner:function(e){var t=this;console.log("set new owner id",e,t.selectedTable),null!=e?(t.selectedTable.user_account_id=e.reference_id,t.addRelation({tableName:"world",id:t.selectedTable.reference_id,relationId:t.selectedTable.user_account_id,relationName:"user_account_id"}).then((function(){t.$q.notify({message:"Saved"}),t.selectedTable.user_account_id=e})).catch((function(e){console.log("Failed to save new owner",e),t.$q.notify({message:"Failed to save"})}))):t.removeRelation({tableName:"world",id:t.selectedTable.reference_id,relationName:"user_account_id",relationId:t.selectedTable.user_account_id}).then((function(){t.selectedTable.user_account_id=null,t.$q.notify({message:"Removed owner"})})).catch((function(e){console.log("Failed to remove owner",e),t.$q.notify({message:"Failed to save"})}))},showOwnerSelectionBox:function(){this.ownerSelectionBox=!0},groupChangeForTableGroups:function(){this.groupChangeFor="tableGroups",this.addToGroup=!0},groupChangeForNewRowGroups:function(){this.groupChangeFor="newRowGroups",this.addToGroup=!0}},Object(S["b"])(["loadData","loadModel","loadDataRelations","updateRow","removeRelation","addRelation","addManyRelation","loadDataRelations"])),{},{refresh:function(){var e=this;console.log("Table schema json",e.selectedTable),e.selectedPermissionOption=e.selectedTable.permission,e.tableSchema=JSON.parse(e.selectedTable.world_schema_json);var t=e.selectedTable.permission;e.parsedGuestPermission={canPeek:(t&e.permissionStructure.GuestPeek)===e.permissionStructure.GuestPeek,canRead:(t&e.permissionStructure.GuestRead)===e.permissionStructure.GuestRead,canCreate:(t&e.permissionStructure.GuestCreate)===e.permissionStructure.GuestCreate,canUpdate:(t&e.permissionStructure.GuestUpdate)===e.permissionStructure.GuestUpdate,canDelete:(t&e.permissionStructure.GuestDelete)===e.permissionStructure.GuestDelete,canRefer:(t&e.permissionStructure.GuestRefer)===e.permissionStructure.GuestRefer,canExecute:(t&e.permissionStructure.GuestExecute)===e.permissionStructure.GuestExecute},e.parsedOwnerPermission={canPeek:(t&e.permissionStructure.UserPeek)===e.permissionStructure.UserPeek,canRead:(t&e.permissionStructure.UserRead)===e.permissionStructure.UserRead,canCreate:(t&e.permissionStructure.UserCreate)===e.permissionStructure.UserCreate,canUpdate:(t&e.permissionStructure.UserUpdate)===e.permissionStructure.UserUpdate,canDelete:(t&e.permissionStructure.UserDelete)===e.permissionStructure.UserDelete,canRefer:(t&e.permissionStructure.UserRefer)===e.permissionStructure.UserRefer,canExecute:(t&e.permissionStructure.UserExecute)===e.permissionStructure.UserExecute},e.parsedGroupPermission={canPeek:(t&e.permissionStructure.GroupPeek)===e.permissionStructure.GroupPeek,canRead:(t&e.permissionStructure.GroupRead)===e.permissionStructure.GroupRead,canCreate:(t&e.permissionStructure.GroupCreate)===e.permissionStructure.GroupCreate,canUpdate:(t&e.permissionStructure.GroupUpdate)===e.permissionStructure.GroupUpdate,canDelete:(t&e.permissionStructure.GroupDelete)===e.permissionStructure.GroupDelete,canRefer:(t&e.permissionStructure.GroupRefer)===e.permissionStructure.GroupRefer,canExecute:(t&e.permissionStructure.GroupExecute)===e.permissionStructure.GroupExecute},this.loadTableGroups()},loadTableGroups:function(){var e=this;e.loadDataRelations({tableName:"world",relation:"usergroup_id",reference_id:e.selectedTable.reference_id}).then((function(t){console.log("Loaded groups of table",e.selectedTable.table_name,t),e.tableGroups=t.data})).catch((function(t){e.$q.notify({message:"Failed to load usergroups: "+JSON.stringify(t)})}))}}),data:function(){return tt(tt({text:"",selectedPermissionOption:null,simplePermissionOptions:[{label:"Guests cannot see the data in this table",value:2097024},{label:"Guests can read rows",value:2097027},{label:"Guests can read rows or execute actions on them",value:2097059},{label:"Guests can read and create rows",value:2097031},{label:"Guests can read, create rows and execute some actions on them",value:2097063},{label:"Guests CANNOT read, create rows BUT execute some actions on them",value:2097056}],permissionTypeTab:"basic",newOwnerId:null,ownerSelectionBox:!1,newGroupName:"",groupChangeFor:null,addToGroupId:null,tableSchema:{},addToGroup:!1,addToGroupSwitch:"addExisting",tableGroups:[],selectedTab:"tablePermissions"},Object(S["d"])([])),{},{permissionStructure:{None:0,GuestPeek:1,GuestRead:2,GuestCreate:4,GuestUpdate:8,GuestDelete:16,GuestExecute:32,GuestRefer:64,UserPeek:128,UserRead:256,UserCreate:512,UserUpdate:1024,UserDelete:2048,UserExecute:4096,UserRefer:8192,GroupPeek:16384,GroupRead:32768,GroupCreate:65536,GroupUpdate:1<<17,GroupDelete:1<<18,GroupExecute:1<<19,GroupRefer:1<<20},parsedGuestPermission:{canPeek:!1,canRead:!1,canCreate:!1,canUpdate:!1,canDelete:!1,canRefer:!1,canExecute:!1},parsedOwnerPermission:{canPeek:!1,canRead:!1,canCreate:!1,canUpdate:!1,canDelete:!1,canRefer:!1,canExecute:!1},parsedGroupPermission:{canPeek:!1,canRead:!1,canCreate:!1,canUpdate:!1,canDelete:!1,canRefer:!1,canExecute:!1},userAccounts:[],userGroups:[]})},mounted:function(){var e=this;this.loadData({tableName:"user_account",params:{page:1,size:500}}).then((function(t){e.userAccounts=t.data})).catch((function(t){e.$q.notify({message:"Failed to load users list: "+JSON.stringify(t)})})),e.loadData({tableName:"usergroup",params:{page:1,size:500}}).then((function(t){e.userGroups=t.data})).catch((function(t){e.$q.notify({message:"Failed to load usergroups list: "+JSON.stringify(t)})})),this.refresh()},computed:tt(tt({},Object(S["c"])(["tables"])),Object(S["d"])([])),watch:{selectedTable:function(e,t){this.refresh()},parsedOwnerPermission:function(e,t){console.log("Permission changed",e,t)}}},at=nt,ot=a("de5e"),lt=a("f09f"),it=a("a370"),rt=a("4b7e"),st=a("2bb1"),ct=a("24e8"),ut=a("7f67"),dt=Object(R["a"])(at,Xe,Ze,!1,null,null,null),pt=dt.exports;Je()(dt,"components",{QPageSticky:ot["a"],QBtn:Ae["a"],QCard:lt["a"],QCardSection:it["a"],QSelect:He["a"],QCardActions:rt["a"],QMarkupTable:st["a"],QDialog:ct["a"]}),Je()(dt,"directives",{ClosePopup:ut["a"]});var mt=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"q-pa-md"},[n("span",{staticClass:"text-h4"},[e._v("Help")])])]),n("div",{staticClass:"col-12 q-pa-md"},[e._t("help-content")],2)]),(e.showHelp=!0)?n("q-page-sticky",{attrs:{position:"top-right",offset:[10,10]}},[n("q-btn",{attrs:{flat:"",size:"sm",fab:"",icon:"fas fa-times"},on:{click:function(t){return e.$emit("closeHelp")}}})],1):e._e()],1)},ft=[];function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var gt={name:"PageIndex",methods:ht({},Object(S["b"])([])),data:function(){return{text:""}},mounted:function(){}},vt=gt,wt=a("9989"),yt=Object(R["a"])(vt,mt,ft,!1,null,null,null),Ct=yt.exports;Je()(yt,"components",{QPage:wt["a"],QPageSticky:ot["a"],QBtn:Ae["a"]});var Tt=a("3212"),_t=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"q-pa-md q-gutter-sm"},[n("q-breadcrumbs",{scopedSlots:e._u([{key:"separator",fn:function(){return[n("q-icon",{attrs:{size:"1.2em",name:"arrow_forward"}})]},proxy:!0}])},e._l(e.bread,(function(e,t){return n("q-breadcrumbs-el",{key:t,style:{cursor:e.click?"pointer":""},attrs:{label:e.label,icon:e.icon},on:{click:function(t){!e.click||e.click()}}})})),1)],1),n("q-separator")],1),n("div",{staticClass:"col-12"},[n("div",{staticClass:"row"},[n("div",{staticClass:"col-12"},[n("q-btn-group",{attrs:{flat:""}},[n("q-btn-dropdown",{attrs:{size:"sm",icon:"fas fa-plus"}},[n("q-list",[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.showNewFileName=!0}}},[n("q-item-section",[n("q-item-label",[e._v("Create file")])],1)],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){e.showNewFolderName=!0}}},[n("q-item-section",[n("q-item-label",[e._v("Create folder")])],1)],1)],1)],1),n("q-btn",{attrs:{size:"sm",icon:"fas fa-upload"},on:{click:function(t){(e.showUploadFile=!0)&&(e.uploadedFiles=[])}}}),n("q-btn",{attrs:{size:"sm",icon:"fas fa-sync-alt"},on:{click:function(t){return e.refreshCache()}}}),e.showDelete?n("q-btn",{staticClass:"float-right",attrs:{flat:"",size:"sm",color:"negative",icon:"fas fa-times"},on:{click:e.deleteSelectedFiles}}):e._e(),n("q-space")],1),n("q-btn-group",{staticClass:"float-right",attrs:{flat:""}})],1)]),e.showUploadFile?n("div",{staticClass:"row",staticStyle:{"min-height":"300px"}},[n("file-upload",{ref:"upload",staticClass:"bg-grey-3",staticStyle:{height:"300px",width:"100%"},attrs:{multiple:!0,drop:!0,"drop-directory":!1,"post-action":"/post.method","put-action":"/put.method"},on:{"input-file":e.inputFile,"input-filter":e.inputFilter},model:{value:e.uploadedFiles,callback:function(t){e.uploadedFiles=t},expression:"uploadedFiles"}},[n("div",{staticClass:"container"},[0==e.uploadedFiles.length?n("span",{staticClass:"vertical-middle",staticStyle:{"padding-top":"40%"}},[e._v("Drop files or click to select "),n("br")]):e._e(),e.uploadedFiles.length>0?n("div",{staticClass:"row"},e._l(e.uploadedFiles,(function(t){return n("div",{staticClass:"col-12"},[e._v(e._s(t.name)+" - Error: "+e._s(t.error)+", Success:\n              "+e._s(t.success)+"\n            ")])})),0):e._e()])]),n("q-btn",{attrs:{label:"Close"},on:{click:function(t){t.stopPropagation(),(e.showUploadFile=!1)&&(e.uploadedFiles=[])}}})],1):e._e(),"table"===e.viewType?n("div",{staticClass:"row"},[n("q-markup-table",{staticStyle:{width:"100%","box-shadow":"none"}},[n("tbody",[n("tr",{staticStyle:{cursor:"pointer"},on:{click:function(t){return e.getContentOnPath({name:".."})}}},[n("td",{staticClass:"text-right"}),n("td",[n("i",{staticClass:"fas fa-level-up-alt"})]),n("td",[e._v("..")]),n("td",{staticClass:"text-right"})]),e._l(e.fileList,(function(t){return n("tr",{staticStyle:{cursor:"pointer"},on:{click:function(n){return e.getContentOnPath(t)}}},[n("td",{staticStyle:{width:"50px"}},[n("q-checkbox",{attrs:{size:e.showDelete?"xl":"md",flat:"",icon:"fas fa-wrench"},on:{input:function(n){return e.selectFile(t)}},model:{value:t.selected,callback:function(n){e.$set(t,"selected",n)},expression:"file.selected"}})],1),n("td",{staticStyle:{width:"50px"}},[n("i",{class:t.icon})]),n("td",[e._v(e._s(t.name))]),n("td",{staticClass:"text-right"},[e._v(e._s(t.is_dir?"":t.size>1048576?parseInt(t.size/1048576)+" mb":parseInt(t.size/1024)+" kbs")+"\n          ")])])}))],2)])],1):e._e()]),n("q-dialog",{attrs:{persistent:""},model:{value:e.showNewFolderName,callback:function(t){e.showNewFolderName=t},expression:"showNewFolderName"}},[n("q-card",{staticStyle:{"min-width":"350px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Folder name")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-input",{attrs:{dense:"",autofocus:""},model:{value:e.newFolderName,callback:function(t){e.newFolderName=t},expression:"newFolderName"}})],1),n("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(t){e.showNewFolderName=!1}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Create"},on:{click:function(t){return e.createFolder()}}})],1)],1)],1),n("q-dialog",{attrs:{persistent:""},model:{value:e.showNewFileName,callback:function(t){e.showNewFileName=t},expression:"showNewFileName"}},[n("q-card",{staticStyle:{"min-width":"350px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("File name")])]),n("q-card-section",{staticClass:"q-pt-none"},[n("q-input",{attrs:{dense:"",autofocus:""},model:{value:e.newFileName,callback:function(t){e.newFileName=t},expression:"newFileName"}})],1),n("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"},on:{click:function(t){e.showNewFileName=!1}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Create"},on:{click:function(t){return e.createFile()}}})],1)],1)],1),n("q-dialog",{attrs:{square:!0},model:{value:e.filePreview,callback:function(t){e.filePreview=t},expression:"filePreview"}},[n("q-card",{staticClass:"row",staticStyle:{width:"80%",height:"80%"},attrs:{flat:""}},[n("q-card-section",{staticStyle:{width:"100%",height:"100%"}},[n("iframe",{staticStyle:{padding:"10px",width:"100%",height:"100%"},attrs:{src:e.previewUrl}})])],1)],1),n("q-page-sticky",{attrs:{position:"bottom-right",offset:[20,20]}},[n("q-btn",{attrs:{flat:"",icon:"fas fa-times"},on:{click:function(t){return e.$emit("close")}}})],1)],1)},xt=[];a("28a5"),a("aef6");function qt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qt(Object(n),!0).forEach((function(t){O()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}(function(){var e=document.createElement("a");document.body.appendChild(e),e.style="display: none"})();var St={name:"FileBrowserComponent",props:["site","path"],data:function(){return{showDelete:!1,showNewFileName:!1,newFileName:null,newFolderName:null,showNewFolderName:!1,showUploadFile:!1,uploadedFiles:[],fileList:[],bread:[],currentPath:"",filePreview:!1,previewUrl:null,viewType:"table"}},computed:{},watch:{},methods:Ot({deleteSelectedFiles:function(){var e=this,t=this.fileList.filter((function(e){return e.selected}));for(var n in t)console.log("Delete fileIndex",this.site,this.currentPath,t[n]),e.executeAction({tableName:"cloud_store",actionName:"delete_path",params:{cloud_store_id:e.site.cloud_store_id.id,path:this.currentPath+"/"+t[n].name}}).then((function(e){console.log("deleted",e),t.selected=!1,t.splice(n,1)})).catch((function(e){console.log("failed to delete",e)}))},selectFile:function(e){console.log("Select file",e,this.fileList),this.showDelete=this.fileList.filter((function(e){return e.selected})).length>0},createFile:function(){var e=this;""!==e.newFileName&&e.newFileName&&(e.executeAction({tableName:"cloud_store",actionName:"upload_file",params:{file:[{name:e.newFileName,file:"data:text/plain;base64,",type:"text/plain"}],path:e.currentPath,cloud_store_id:e.site.cloud_store_id.id}}).then((function(){e.getContentOnPath({name:".",is_dir:!1}),e.$q.notify({message:"File created"})})).catch((function(t){console.log("Failed to create file",t),e.$q.notify({message:"Failed to create create file"})})),e.showNewFileName=!1)},createFolder:function(){var e=this;e.executeAction({tableName:"cloud_store",actionName:"create_folder",params:{cloud_store_id:e.site.cloud_store_id.id,path:e.currentPath,name:e.newFolderName}}).then((function(){e.getContentOnPath({name:".",is_dir:!1})})).catch((function(t){console.log("Failed to create folder",t),e.$q.notify({message:"Failed to create folder"})}))},inputFile:function(t){console.log("input file",arguments);var n=this,a=function(a){return new Promise((function(o,l){var i=a.name,r=a.type,s=new FileReader;s.onload=function(e){console.log("File loaded",e);var a={params:{file:[]}};a["params"]["file"].push({name:i,file:e.target.result,type:r}),console.log("Upload file current path",n.currentPath),a.params.path=n.currentPath,a.tableName="cloud_store",a.actionName="upload_file",a.params.cloud_store_id=n.site.cloud_store_id.id,n.executeAction(a).then((function(e){console.log("Upload done",arguments),t.success=!0,n.getContentOnPath({is_dir:!1,name:"."})})).catch((function(e){console.log("Failed to upload",arguments)})),o()},s.onerror=function(){console.log("Failed to load file onerror",e,arguments),l(i)},s.readAsDataURL(a)}))};a(t.file)},inputFilter:function(){console.log("input filter",arguments)},makeFile:function(e){var t=e.name,n="fas fa-file";return t.endsWith("html")?n="fas fa-code":t.endsWith("mp3")||t.endsWith("wav")?n="fas fa-file-audio":t.endsWith("mp4")||t.endsWith("mkv")?n="fas fa-file-video":t.endsWith("jpg")||t.endsWith("jpeg")||t.endsWith("png")||t.endsWith("gif")?n="fas fa-image":t.endsWith("md")&&(n="fas fa-markdown"),e.is_dir&&(n="fas fa-folder"),e.icon=n,e},refreshCache:function(){var e=this;e.executeAction({tableName:"site",actionName:"sync_site_storage",params:{site_id:e.site.id,path:""}}).then((function(){e.getContentOnPath({name:".",is_dir:!1})})).catch((function(t){e.$q.notify({message:"Failed to sync site cache"})}))},getContentOnPath:function(e){console.log("Get content on path",e);var t=this;if(t.showDelete=!1,e.is_dir)"/"!==e.name&&""!==e.name?(t.currentPath=t.currentPath+(""===t.currentPath?"":"/")+e.name,t.bread.push({icon:"fas fa-folder",label:e.name})):(t.currentPath="",t.bread=[t.bread[0]]);else if(".."===e.name){if(1===t.bread.length)return;var n=t.currentPath.split("/").filter((function(e){return e.length>0}));n.length<1?t.currentPath="":(e.is_dir=!0,n.pop(),t.bread.pop(),t.currentPath=n.join("/"))}if("."===e.name&&(e.is_dir=!0),console.log("Final path",t.currentPath,e.is_dir),e.is_dir||".."===e.name)t.executeAction({tableName:"site",actionName:"list_files",params:{site_id:t.site.id,path:t.currentPath}}).then((function(e){var n=e[0].Attributes["list"];if(console.log("list files Response",n),n){t.showFileBrowser=!0;var a=n.map(t.makeFile);a.sort((function(e,t){return e.is_dir<t.is_dir})),a=a.map((function(e){return e.selected=!1,e})),t.fileList=a}else t.fileList=[]})).catch((function(e){console.log("failed to list files",e),t.getContentOnPath({name:"",is_dir:!1})}));else{var a=t.site.hostname,o="80"!==window.location.port?":"+window.location.port:"";"site.daptin.com"===window.location.hostname&&(o=":6336");var l="http://"+a+o+"/"+t.currentPath+"/"+e.name;t.previewUrl=l,t.filePreview=!0,console.log("Fetch url: ",l)}},listFiles:function(e){console.log("list files in site",e);var t=this;t.getContentOnPath({name:"",is_dir:!0})}},Object(S["b"])(["executeAction"])),mounted:function(){var e=this;console.log("Mounted file browser",this.site),this.currentPath="",this.bread.push({label:e.site.hostname,icon:"fas fa-home",click:function(){e.getContentOnPath({name:"/",is_dir:!0})}}),this.listFiles(this.site)}},kt=St,Nt=a("ead5"),jt=a("0016"),Pt=a("079e"),Rt=a("e7a9"),Ft=a("f20b"),Gt=a("1c1c"),Dt=a("66e5"),It=a("4074"),$t=a("0170"),Ut=a("2c91"),Qt=Object(R["a"])(kt,_t,xt,!1,null,null,null),At=Qt.exports;Je()(Qt,"components",{QBreadcrumbs:Nt["a"],QIcon:jt["a"],QBreadcrumbsEl:Pt["a"],QSeparator:ze["a"],QBtnGroup:Rt["a"],QBtnDropdown:Ft["a"],QList:Gt["a"],QItem:Dt["a"],QItemSection:It["a"],QItemLabel:$t["a"],QBtn:Ae["a"],QSpace:Ut["a"],QMarkupTable:st["a"],QCheckbox:Ve["a"],QCard:lt["a"],QCardSection:it["a"],QDialog:ct["a"],QInput:Qe["a"],QCardActions:rt["a"],QPageSticky:ot["a"]}),Je()(Qt,"directives",{ClosePopup:ut["a"]}),d["a"].prototype.$axios=je.a;var Et=a("8019");d["a"].component("file-upload",Et),d["a"].component("vuefinder",Tt["a"]),d["a"].component("file-browser",At),d["a"].component("table-side-bar",Pe["a"]),d["a"].component("table-permissions",pt),d["a"].component("table-editor",Ye),d["a"].component("help-page",Ct);var Mt=a("4b46");function zt(){return Bt.apply(this,arguments)}function Bt(){return Bt=u()(s.a.mark((function e(){var t,n,a,o,l,i,r,c,u;return s.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Te();case 2:t=e.sent,n=t.app,a=t.store,o=t.router,l=!0,i=function(e){l=!1,window.location.href=e},r=window.location.href.replace(window.location.origin,""),c=[ke,void 0,Mt["default"]],u=0;case 11:if(!(!0===l&&u<c.length)){e.next=29;break}if("function"===typeof c[u]){e.next=14;break}return e.abrupt("continue",26);case 14:return e.prev=14,e.next=17,c[u]({app:n,router:o,store:a,Vue:d["a"],ssrContext:null,redirect:i,urlPath:r});case 17:e.next=26;break;case 19:if(e.prev=19,e.t0=e["catch"](14),!e.t0||!e.t0.url){e.next=24;break}return window.location.href=e.t0.url,e.abrupt("return");case 24:return console.error("[Quasar] boot error:",e.t0),e.abrupt("return");case 26:u++,e.next=11;break;case 29:if(!1!==l){e.next=31;break}return e.abrupt("return");case 31:new d["a"](n);case 32:case"end":return e.stop()}}),e,null,[[14,19]])}))),Bt.apply(this,arguments)}zt()},"31cd":function(e,t,n){},a633:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"q-pa-md q-gutter-sm"},[n("q-breadcrumbs",{scopedSlots:e._u([{key:"separator",fn:function(){return[n("q-icon",{attrs:{size:"1.2em",name:"arrow_forward"}})]},proxy:!0}])},[n("q-breadcrumbs-el",{attrs:{label:"Database",icon:"fas fa-database"}}),n("q-breadcrumbs-el",{attrs:{label:"Tables",icon:"fas fa-table"}})],1)],1),n("q-separator"),n("q-page-sticky",{staticStyle:{"z-index":"3000"},attrs:{position:"bottom-right",offset:[50,50]}},[n("q-btn",{attrs:{fab:"",icon:"add",color:"primary"},on:{click:function(t){return e.$router.push("/tables/create")}}})],1),n("div",{staticClass:"row"},[n("div",{staticClass:"col-12 q-gutter-sm"},[n("q-markup-table",{attrs:{flat:""}},[n("tbody",e._l(e.tablesFiltered,(function(t){return n("tr",{staticStyle:{cursor:"pointer"},on:{click:function(n){return e.$router.push("/tables/data/"+t.table_name)}}},[n("td",[e._v(e._s(t.table_name))]),n("td",{attrs:{align:"right"}},[n("q-btn",{attrs:{flat:"",icon:"fas fa-wrench"},on:{click:function(n){return n.stopPropagation(),e.$router.push("/tables/edit/"+t.table_name)}}})],1),n("td",{attrs:{align:"left"}},[n("q-btn",{attrs:{flat:"",icon:"fas fa-list"},on:{click:function(n){return n.stopPropagation(),e.$router.push("/tables/data/"+t.table_name)}}})],1)])})),0)])],1)]),e.showHelp?e._e():n("q-page-sticky",{attrs:{position:"top-right",offset:[0,0]}},[n("q-btn",{attrs:{flat:"",fab:"",icon:"fas fa-question"},on:{click:function(t){e.showHelp=!0}}})],1),n("q-drawer",{attrs:{overlay:"",width:400,side:"right"},model:{value:e.showHelp,callback:function(t){e.showHelp=t},expression:"showHelp"}},[n("q-scroll-area",{staticClass:"fit"},[n("help-page",{on:{closeHelp:function(t){e.showHelp=!1}},scopedSlots:e._u([{key:"help-content",fn:function(){return[n("q-markdown",{attrs:{src:"::: tip\nDaptin creates **user_account** table automatically. You can create new tables and edit existing tables, or view table data.\n:::"}})]},proxy:!0}])})],1)],1)],1)},o=[],l=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("06db"),n("456d"),n("c47a")),i=n.n(l),r=n("2f62");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={name:"TableSideBar",methods:c({setTable:function(e){console.log("set table",e),this.setSelectedTable(e)}},Object(r["b"])(["setSelectedTable"])),data:function(){return{text:"",showHelp:!1,selectedTable:null}},mounted:function(){},computed:c({tableOptions:function(){return console.log(this.tablesFiltered),this.tablesFiltered.map((function(e){return{label:e.table_name,value:e.table_name}}))},tablesFiltered:function(){var e=this;return console.log("Get tables filtered",e.tables),e.text&&e.text.length>0?e.tables.filter((function(t){return t.table_name.indexOf(e.text)>-1&&!t.is_hidden})):e.tables.filter((function(e){return!e.is_hidden}))}},Object(r["c"])(["tables"])),watch:{tables:function(){console.log("updated tables  in watch ",this.tables,this.tablesFiltered)}}},d=u,p=n("2877"),m=n("ead5"),f=n("0016"),b=n("079e"),h=n("eb85"),g=n("de5e"),v=n("9c40"),w=n("2bb1"),y=n("9404"),C=n("4983"),T=n("eebe"),_=n.n(T),x=Object(p["a"])(d,a,o,!1,null,null,null);t["a"]=x.exports;_()(x,"components",{QBreadcrumbs:m["a"],QIcon:f["a"],QBreadcrumbsEl:b["a"],QSeparator:h["a"],QPageSticky:g["a"],QBtn:v["a"],QMarkupTable:w["a"],QDrawer:y["a"],QScrollArea:C["a"]})},ed82:function(e,t,n){}},[[0,5,0]]]);